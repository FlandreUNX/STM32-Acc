/*
 * DTW.c
 *
 *  Created on: 17 de jan de 2017
 *      Author: Alan
 */

#include "DTW.h"

int16_t letterO[300] = {124, 82, -5, -9, 126, 150, 30, -68, -134, -442, -328, -114, 43, 46, 82, 116, 138, 179, 265, 274, 267, 253, 243, 310, 314, 291, 238, 191, 218, 317, 373, 410, 364, 479, 372, 478, 554, 543, 364, 239, 319, 385, 454, 377, 403, 290, 228, 252, 216, 197, 115, 120, 201, 235, 191, 195, 137, 162, 197, 102, 42, 107, 120, 53, -129, -124, -102, -176, -264, -119, -113, -256, -300, -183, -61, -240, -427, -321, -302, -450, -443, -247, -324, -510, -511, -474, -477, -280, -195, -249, -230, -221, -206, -35, 198, 97, -230, 211, 356, 326, 997, 554, 32106, 28671, -30539, 17263, -28965, -27021, -28513, 20079, -13563, 13582, -12984, 4287, 28415, -26578, -8050, -27244, -25319, -26293, -13340, 18836, 18664, 10016, 1505, -22842, -19507, 2525, -2242, -19377, 26162, -24966, 11381, -26634, -32063, 15113, 14421, 27082, 9744, -7929, 27257, -17734, -18212, -1668, -20809, -10356, 27476, -11887, -28851, -11572, -8433, -21211, 7656, -28711, -27226, -14432, -21204, 30851, 24093, 22208, 15917, -11256, 9929, -10397, 18945, 12494, -3947, -16782, -17450, 29954, 7894, 2933, 32412, 21324, -20697, 29302, 16309, 6146, 21166, 776, -4621, -25507, 2704, 15083, 27513, 23021, 17555, -18629, 15875, 22135, 26841, 21463, 14965, -19043, 1253, 19959, -5549, -19769, -11707, -7907, 28016, 3230, 3080, 13436, 8165, -27267, 18667, -25775, 12932, -22128, 14212, -30963, -9050, -25643, -30886, -12662, 7724, 10214, 2333, -23216, 5325, 29138, 12529, -16636, -32446, 10371, 12932, -25209, -26727, -27900, -19466, -26460, 2505, 7483, 20625, 13589, -27329, 7733, 28946, -3062, -2735, 10220, 23630, -21435, -8353, -25354, 23533, -569, -21299, -11026, 8957, -13988, -3589, 9377, 3375, 31947, 5122, -27793, 17624, -15262, 21818, -28683, -17282, 6131, 27129, 22103, 22557, 13085, -19156, -263, -23221, -15068, 24826, -30946, 16397, -4512, -20270, -13675, -16420, -31131, 17608, -27388, 30665, -9506, 18556, 26685, -24389, 25078, 8492, 2048, 0, 0, 0, 0, 8492, 2048, 429, 2048, 8447, 2048};
//double letterO[300] = {91.799999999999983, 88.859999999999985, 60.701999999999984, 39.791399999999982, 65.65397999999999, 90.957785999999999, 72.670450200000005, 30.469315139999999, -18.871479401999999, -145.8100355814, -200.46702490697999, -174.52691743488597, -109.26884220442017, -62.688189543094111, -19.281732680165877, 21.302787123883881, 56.311950986718713, 93.118365690703087, 144.68285598349217, 183.47799918844453, 208.53459943191115, 221.8742196023378, 228.21195372163646, 252.74836760514552, 271.12385732360184, 277.08670012652129, 265.36069008856487, 243.05248306199542, 235.53673814339675, 259.97571670037769, 293.88300169026434, 328.71810118318501, 339.30267082822951, 381.21186957976062, 378.44830870583246, 408.31381609408277, 452.01967126585788, 479.31376988610054, 444.71963892027037, 383.00374724418924, 363.80262307093244, 370.16183614965269, 395.31328530475685, 389.81929971332977, 393.77350979933078, 362.6414568595315, 322.24901980167203, 301.17431386117039, 275.62201970281927, 252.03541379197347, 210.92478965438141, 183.64735275806697, 188.85314693064686, 202.6972028514528, 199.18804199601692, 197.93162939721182, 179.65214057804826, 174.35649840463378, 181.14954888324365, 157.40468421827055, 122.78327895278937, 118.04829526695255, 118.63380668686678, 98.943664680806734, 30.560565276564709, -15.807604306404702, -41.665323014483292, -81.965726110138291, -136.5760082770968, -131.30320579396775, -125.81224405577743, -164.8685708390442, -205.40799958733095, -198.68559971113166, -157.37991979779216, -182.16594385845451, -255.61616070091816, -275.23131249064272, -283.26191874344988, -333.28334312041488, -366.19834018429037, -330.43883812900322, -328.50718669030226, -382.95503068321159, -421.36852147824811, -437.15796503477367, -449.11057552434158, -398.37740286703911, -337.36418200692736, -310.85492740484915, -286.59844918339439, -266.91891442837607, -248.64324009986325, -184.55026806990426, -69.785187648932975, -19.749631354253079, -82.824741947977159, 5.3226806364159884, 110.52587644549119, 175.16811351184384, 421.71767945829066, 461.40237562080341, 9954.7816629345616, 15569.647164054193, 1737.0530148379348, 6394.8371103865538, -4213.1140227294127, -11055.479815910589, -16292.735871137411, -5381.2151097961878, -7835.750576857331, -1410.4254038001313, -4882.4977826600916, -2131.6484478620641, 7032.3460864965555, -3050.7577394524114, -4550.5304176166883, -11358.571292331682, -15546.699904632176, -18770.589933242522, -17141.412953269763, -6348.1890672888321, 1155.467652897818, 3813.627357028472, 3121.0391499199304, -4667.8725950560483, -9119.6108165392325, -5626.2275715774622, -4610.9593001042231, -9040.7715100729547, 1520.0599429489312, -6425.7580399357475, -1083.7306279550235, -8748.811439568517, -15743.068007697962, -6486.247605388573, -214.07332377200055, 7974.7486733595988, 8505.5240713517196, 3575.1668499462039, 10679.716794962342, 2155.6017564736385, -3954.6787704684525, -3268.6751393279169, -8530.7725975295416, -9078.3408182706789, 1887.9614272105246, -2244.527000952633, -10226.468900666841, -10630.128230466789, -9970.9897613267512, -13342.992832928725, -7043.2949830501075, -13543.606488135074, -17648.32454169455, -16683.427179186183, -18039.599025430329, -3372.4193178012301, 4867.2064775391391, 10069.444534277398, 11823.711173994177, 4899.7978217959244, 6408.5584752571467, 1366.8909326800026, 6640.3236528760017, 8396.4265570132011, 4693.3985899092404, -1749.2209870635315, -6459.4546909444725, 4464.5817163388683, 5493.4072014372068, 4725.2850410060446, 13031.299528704232, 15519.109670092963, 4654.2767690650735, 12048.593738345551, 13326.715616841884, 11172.500931789318, 14170.550652252521, 10152.185456576763, 5720.2298196037336, -3647.9391262773861, -1742.3573883941704, 3305.2498281240805, 10567.574879686856, 14303.602415780799, 15279.021691046559, 5106.6151837325915, 8337.1306286128129, 12476.491440028969, 16785.844008020278, 18188.990805614194, 17221.793563929936, 6342.3554947509547, 4815.5488463256679, 9358.5841924279666, 4886.3089346995766, -2510.2837457102964, -5269.2986219972072, -6060.6090353980453, 4162.3736752213681, 3882.6615726549576, 3641.8631008584703, 6580.1041706009291, 7055.5729194206497, -3241.1989564055448, 3331.2607305161182, -5400.617488638718, 99.167757952897773, -6568.9825694329711, -334.68779860308041, -9523.1814590221566, -9381.2270213155098, -14259.758914920856, -19247.6312404446, -17271.94186831122, -9773.1593078178521, -3777.0115154724963, -1944.0080608307471, -8325.6056425815223, -4230.4239498070656, 5780.1032351350541, 7804.7722645945378, 472.54058521617571, -9403.0215903486769, -3470.8151132440739, 1450.0294207291481, -6547.6794054895963, -12601.475583842715, -17191.0329086899, -17873.52303608293, -20449.466125258048, -13563.126287680632, -7249.2884013764415, 1112.9981190364915, 4855.7986833255436, -4799.6409216721186, -1039.8486451704825, 7955.9059483806614, 4650.5341638664622, 2434.8739147065235, 4770.4117402945667, 10428.288218206197, 869.30175274433714, -1897.3887730789643, -8934.3721411552742, 805.83950119130805, 393.38765083391564, -6114.3286444162586, -7587.8300510913814, -2624.3810357639663, -6033.4667250347757, -5300.1267075243422, -896.98869526703947, 384.60791331307246, 9853.3255393191503, 8433.9278775234052, -2434.1504857336167, 3583.2946599864681, -2070.2937380094718, 5096.1943833933692, -5037.5639316246416, -8710.8947521372484, -4258.3263264960733, 5157.8715714527489, 10241.410100016923, 13936.087070011845, 13680.76094900829, 3829.7326643058032, 2601.9128650140619, -5144.9609944901567, -8121.8726961431094, 1762.4891126998227, -8050.0576211101234, -715.94033477708672, -1854.7582343439606, -7379.330764040772, -9268.0315348285403, -11413.622074379979, -17328.835452065985, -6847.7848164461884, -13009.849371512331, 92.605439941367877, -2786.9761920410424, 3615.9166655712706, 10536.64166589989, 58.94916612992256, 7564.6644162909452, 7842.8650914036607, 6104.4055639825619, 4273.0838947877928, 2991.1587263514548, 2093.8111084460184, 1465.6677759122128, 3573.5674431385487, 3115.8972101969839, 2309.8280471378885, 2231.2796329965217, 4095.9957430975651, 3481.5970201682953};

//int16_t letterL[300] = {11, -11, -36, -10, 34, 52, 26, 0, -60, -36, 46, 27, 25, 22, 49, 32, -32, -78, -74, -17, 94, 108, 109, 19, -129, -65, -26, -79, 22, -65, -48, -55, 31, 102, 52, -3, 30, -1, -50, 1, 20, 108, -25, -79, 26, 124, 29, -67, -39, 65, 57, 21, -83, -67, -31, -63, -37, 19, 55, 83, 0, -91, -17, -144, -104, 13, 105, 34, 16, 31, 83, 152, 138, 121, 187, 195, 211, 187, 187, 176, 179, 100, 16, -19, -36, -27, -61, -114, -50, -9, -24, 34, 16, -11, -51, -134, -136, -121, -126, -109, 925, 413, 31850, 27647, -30507, 879, -24845, -28045, -10097, 20079, -5371, 13710, -12984, 5503, -20769, -26578, -5473, -27500, -25319, -26293, -13344, -13932, 18658, 26145, 1505, -23842, -3124, -30435, -2242, -19377, -14734, 7786, 11381, -26650, -27959, 2313, 14933, -5686, 9752, -23801, 27000, 16058, -22276, -1028, -21769, -10868, 28500, -28263, -12724, 21228, -8401, -21403, 7657, -29224, -32594, -14432, -21204, 30851, 24093, 4736, 9261, -11256, 9929, -10399, -13823, 12490, -3691, -18830, -25642, 29954, 5846, 2685, -372, 22348, -20697, 29284, 16305, -18430, 21422, 776, -4613, -25009, 3740, 14955, 27257, 23021, 1171, -2245, 15891, 21111, 26841, 21335, 14965, -19059, 9413, 19959, -5517, -19833, -11707, 24893, 28016, 3214, 19464, 31869, -25235, 5501, 26723, -30256, 14984, 2448, 12676, -6387, 23748, -25771, -30768, -8566, 7789, 9190, 2349, -23216, -20259, 12752, 12529, -16604, -16058, 11651, 15236, -25209, -27239, -19676, 13238, -10004, 2505, 5467, 20625, 13589, -25283, 1653, 29970, -3062, -3759, -23060, 23630, -21433, -14498, -25358, 21485, -5949, -21299, -11026, -23875, -9395, -3590, 9379, 3391, 31978, 5154, -23697, 21208, -15008, 5434, -30091, -25474, 1011, 31225, 22103, 22813, 13084, 13612, -1287, -31397, -15068, 25848, -29026, 16393, -6030, -23854, -15723, -18472, -31131, 25672, -27387, 30665, -1329, 18492, 26685, -24389, 16886, 8492, 2048, 0, 0, 0, 0, 8492, 2048, 429, 2048, 8447, 2048};
double letterL[300] = {7.9666666666666668, 2.2766666666666664, -9.2063333333333333, -9.4444333333333326, 3.5888966666666668, 18.112227666666666, 20.478559366666666, 14.334991556666665, -7.9655059103333343, -16.375854137233333, 2.3369021039366675, 9.7358314727556667, 14.315082030928966, 16.620557421650275, 26.334390195155191, 28.034073136608633, 10.023851195626042, -16.383304163061769, -33.668312914143236, -28.667819039900266, 8.1325266720698153, 38.092768670448869, 59.364938069314206, 47.255456648519946, -5.6211803460360343, -23.434826242225224, -24.204378369557656, -40.643064858690359, -21.850145401083246, -34.795101780758273, -38.75657124653079, -43.629599872571546, -21.240719910800081, 15.731496062439943, 26.612047243707959, 17.728433070595571, 21.409903149416898, 14.686932204591827, -4.7191474567857217, -3.0034032197500053, 3.8976177461749963, 35.128332422322494, 17.089832695625745, -11.737117113061979, -0.41598197914338453, 36.908812614599626, 34.536168830219736, 4.0753181811538148, -8.8472772731923293, 13.306905908765369, 26.414834136135756, 24.79038389529503, -7.5467312732934779, -25.382711891305433, -27.067898323913802, -37.847528826739662, -37.593270178717759, -20.615289125102432, 2.0692976124282989, 26.348508328699808, 18.443955830089863, -14.389230918937098, -15.172461643255968, -53.820723150279171, -68.874506205195416, -44.312154343636792, 0.4814919594542495, 10.537044371617974, 12.17593106013258, 17.823151742092804, 37.376206219464962, 71.76334435362547, 91.634341047537816, 100.44403873327647, 126.41082711329352, 146.98757897930545, 166.19130528551381, 172.43391369985966, 176.80373958990177, 176.56261771293123, 177.29383239905184, 154.10568267933627, 112.67397787553539, 73.171784512874765, 40.420249159012336, 20.19417441130863, -4.1640779120839611, -37.114854538458772, -40.980398176921142, -31.386278723844796, -29.170395106691355, -10.219276574683949, -2.353493602278764, -4.9474455215951343, -18.763211865116592, -53.33424830558161, -78.133973813907119, -90.993781669734972, -101.49564716881447, -103.74695301817013, 204.87713288728091, 267.31399302109662, 9742.1197951147678, 15113.583856580339, 1427.408699606236, 1262.8860897243651, -6569.4797371929444, -13012.135816035061, -12137.595071224543, -2472.61654985718, -3342.1315849000257, 1773.507890569982, -2653.7444766010126, -206.72113362070877, -6375.4047935344961, -12436.183355474146, -10347.228348831901, -15493.059844182331, -18440.84189092763, -20796.489323649337, -18560.742526554535, -17172.119768588174, -6423.083838011722, 3347.3413133917948, 2794.6389193742561, -5196.3527564380202, -4574.6469295066136, -12332.75285065463, -9305.52699545824, -12326.968896820767, -13049.078227774535, -6798.5547594421751, -1344.6883316095223, -8936.2818321266659, -14643.097282488665, -9556.2680977420659, -2209.487668419446, -3252.4413678936121, 648.89104247447176, -6686.0762702678703, 3419.7466108124909, 7211.2226275687426, -1634.9441607018807, -1452.8609124913164, -7547.7026387439209, -8543.7918471207449, 2569.3457070154791, -6680.3580050891642, -8493.4506035624145, 422.98457750630951, -2224.2107957455833, -7977.847557021908, -3287.3932899153356, -11068.375302940734, -17526.062712058512, -16597.843898440959, -17979.69072890867, -3330.4835102360685, 4896.5615428347519, 4848.3930799843265, 6172.1751559890281, 943.72260919231985, 3639.3058264346237, -572.18592149576352, -4547.4301450470339, 563.79889846707647, -712.64077107304638, -6147.8485397511322, -11996.093977825793, 588.93421552194377, 2166.0539508653605, 2321.7377656057524, 1513.6164359240267, 7763.9315051468184, -774.34794639722713, 8243.1564375219405, 10661.709506265357, 1934.1966543857498, 7780.537658070024, 5679.1763606490167, 2591.5234524543112, -5688.6335832819823, -2860.0435082973872, 2484.4695441918293, 9916.2286809342804, 13847.660076653996, 10044.662053657796, 6357.7634375604566, 9217.7344062923185, 12785.714084404623, 17002.299859083236, 18302.109901358264, 17300.976930950783, 6392.9838516655482, 7298.9886961658831, 11096.992087316117, 6112.7944611212824, -1670.9438772151025, -4681.7607140505716, 4190.6675001645999, 11338.267250115219, 8900.9870750806531, 12069.890952556456, 18009.623666789517, 5036.236566752661, 5175.6655967268625, 11639.865917708803, -928.89385760383811, 3844.974299677313, 3425.8820097741191, 6200.9174068418833, 2424.5421847893181, 8821.5795293525225, -1556.1943294532339, -10319.736030617263, -9793.6152214320828, -4518.8306550024581, -406.1814585017205, 420.37297904879563, -6670.5389146658435, -10747.07724026609, -3697.3540681862619, 1170.5521522696167, -4161.8134934112677, -7730.6694453878863, -1916.1686117715203, 3229.4819717599357, -5302.0626197680449, -11883.143833837632, -14221.000683686343, -5983.3004785804405, -7189.5103350063082, -4281.1572345044151, -1356.7100641530906, 5237.8029550928368, 7743.162068564985, -2164.6865520045103, -1019.3805864031571, 8277.4335895177901, 4875.603512662452, 2285.2224588637164, -5318.3442787953991, 3366.1590048432208, -4073.5886966097451, -7200.9120876268207, -12648.038461338774, -2408.126922937141, -3470.3888460559983, -8818.9721922391982, -9481.080534567438, -13799.256374197206, -12477.979461938045, -9811.5856233566301, -4054.4099363496407, -1820.7869554447482, 8318.8491311886755, 7369.394391832072, -1950.523925717549, 4997.0332519977155, -1004.4767236015991, 927.06629347888065, -8378.3535945647836, -13507.047516195347, -9151.6332613367431, 2961.35671706428, 8703.8497019449951, 12936.594791361495, 12980.816353953047, 13170.171447767132, 8833.0200134369916, -3235.9859905941066, -6785.5901934158737, 3004.486864608888, -6604.6591947737779, 294.63856365835545, -1602.7530054391511, -8278.1271038074046, -10511.588972665182, -12899.712280865628, -18369.098596605938, -5156.7690176241567, -11825.838312336909, 921.41318136416339, 246.28922695491434, 5720.0024588684391, 12009.501721207907, 1089.9512048455354, 5828.765843391875, 6627.736090374312, 5253.8152632620177, 3677.6706842834119, 2574.3694789983883, 1802.0586352988716, 1261.44104470921, 3430.6087312964469, 3015.8261119075128, 2239.7782783352586, 2182.2447948346808, 4061.6713563842764, 3457.5699494689934};

// Letter O (148)
int16_t smooth2Ox[148] = {-43, -37, -45, -51, -38, -26, -16, -8, 3, 18, 31, 37, 41, 39, 41, 44, 39, 31, 21, 12, 0, -12, -7, -2, -3, -1, 0, -15, -42, -67, -81, -84, -84, -73, -57, -48, -42, -62, -82, -100, -109, -122, -129, -129, -116, -119, -98, -83, -63, -45, -33, -26, -11, -3, 0, -11, -11, -2, 1, 10, -3, -19, -17, -8, 18, 31, 39, 58, 66, 82, 112, 115, 128, 150, 149, 169, 202, 211, 213, 188, 171, 177, 186, 188, 203, 221, 229, 225, 195, 185, 212, 221, 226, 242, 255, 253, 254, 284, 313, 306, 267, 248, 226, 213, 199, 160, 135, 131, 150, 129, 110, 95, 68, 34, 17, 25, 30, 27, 24, 14, -8, -14, -13, -13, -3, 3, -6, -6, -10, -23, -45, -51, -56, -74, -91, -106, -104, -107, -97, -83, -68, -48, -27, -22, -14, -14, -20, -32};
int16_t smooth2Oy[148] = {-965, -965, -963, -961, -958, -959, -959, -962, -962, -971, -980, -988, -989, -994, -1006, -1012, -1018, -1028, -1047, -1063, -1083, -1103, -1108, -1096, -1082, -1067, -1055, -1058, -1076, -1090, -1095, -1098, -1092, -1078, -1051, -1031, -1013, -1015, -1021, -1025, -1025, -1023, -1038, -1038, -1031, -1036, -1023, -1014, -1001, -986, -981, -978, -968, -947, -934, -923, -900, -883, -865, -859, -857, -865, -859, -850, -835, -824, -824, -836, -848, -851, -855, -852, -848, -829, -811, -777, -749, -757, -780, -800, -827, -848, -850, -858, -848, -837, -850, -861, -880, -879, -884, -883, -867, -873, -885, -885, -888, -908, -936, -960, -977, -984, -995, -998, -1003, -1016, -1028, -1036, -1023, -1053, -1068, -1078, -1099, -1129, -1135, -1113, -1078, -1068, -1064, -1055, -1067, -1074, -1079, -1078, -1065, -1046, -1040, -1039, -1021, -1012, -1018, -1012, -1001, -998, -1006, -1014, -1011, -1007, -1005, -988, -974, -956, -950, -950, -951, -952, -942, -958};
int16_t smooth2Oz[148] = {226, 223, 222, 210, 218, 232, 233, 236, 249, 241, 247, 252, 257, 259, 252, 254, 262, 264, 265, 253, 255, 261, 276, 291, 286, 265, 235, 217, 225, 238, 253, 258, 261, 247, 224, 218, 205, 186, 170, 156, 144, 126, 91, 60, 33, 17, 26, 34, 38, 37, 44, 45, 49, 49, 37, 30, 17, -1, -16, -28, -46, -70, -85, -93, -87, -67, -41, -33, -25, -33, -40, -42, -31, -33, -25, -25, -55, -88, -99, -81, -70, -69, -82, -69, -29, 8, 32, 52, 78, 78, 54, 38, 26, 14, 0, -1, 10, 42, 86, 107, 80, 45, 40, 47, 38, 35, 29, 27, 39, 83, 131, 170, 173, 179, 174, 173, 170, 173, 178, 179, 191, 207, 232, 252, 268, 272, 273, 255, 231, 221, 228, 225, 228, 234, 234, 231, 234, 233, 234, 237, 238, 250, 258, 259, 266, 284, 286, 283};

int16_t smooth8Ox[148] = {32, 29, 84, 84, 70, 89, 105, 126, 162, 207, 293, 372, 381, 394, 399, 412, 429, 411, 382, 346, 289, 272, 299, 346, 355, 357, 348, 350, 366, 404, 430, 418, 360, 371, 356, 320, 261, 174, 166, 120, 80, 89, 132, 139, 169, 165, 122, 47, -19, -60, -109, -117, -143, -186, -188, -176, -129, -92, -106, -111, -73, -87, -71, -41, -77, -46, -68, -37, -6, 51, 91, 127, 145, 193, 282, 345, 364, 364, 349, 345, 356, 383, 400, 396, 378, 331, 279, 199, 157, 158, 149, 158, 179, 166, 187, 198, 245, 339, 341, 246, 183, 194, 259, 258, 238, 204, 264, 333, 331, 260, 222, 166, 136, 173, 253, 288, 314, 280, 247, 277, 280, 284, 326, 320, 225, 137, 102, 139, 71, -33, -129, -106, -19, -5, -25, -53, -119, -176, -197, -196, -122, -39, 16, 12, 59, 84, 46, -47};
int16_t smooth8Oy[148] = {-3710, -3714, -3720, -3727, -3710, -3684, -3653, -3663, -3694, -3706, -3722, -3700, -3715, -3704, -3724, -3706, -3687, -3701, -3770, -3831, -3905, -3934, -3915, -3872, -3875, -3908, -3974, -4037, -4104, -4151, -4165, -4183, -4252, -4311, -4363, -4364, -4353, -4414, -4460, -4461, -4438, -4401, -4332, -4251, -4141, -4044, -3948, -3864, -3824, -3805, -3747, -3672, -3630, -3669, -3665, -3641, -3559, -3520, -3476, -3483, -3466, -3458, -3407, -3385, -3427, -3397, -3348, -3293, -3278, -3276, -3278, -3309, -3357, -3390, -3360, -3286, -3319, -3400, -3453, -3459, -3442, -3397, -3383, -3397, -3407, -3407, -3431, -3499, -3538, -3568, -3570, -3554, -3537, -3540, -3570, -3538, -3486, -3527, -3536, -3539, -3525, -3570, -3576, -3652, -3745, -3859, -3869, -3888, -3914, -3973, -4022, -4050, -4024, -3982, -3880, -3812, -3800, -3872, -3953, -3902, -3897, -3849, -3807, -3848, -3961, -4073, -4144, -4100, -4106, -4205, -4264, -4144, -3980, -3917, -3931, -3960, -4002, -4117, -4203, -4232, -4176, -4147, -4108, -4078, -3976, -3884, -3825, -3800};
int16_t smooth8Oz[148] = {1067, 1032, 997, 1003, 1008, 995, 972, 930, 903, 933, 985, 1055, 1123, 1128, 1095, 1087, 1084, 1092, 1080, 1071, 1102, 1113, 1121, 1128, 1108, 1090, 1054, 1009, 997, 1040, 1091, 1116, 1120, 1087, 1075, 1045, 970, 880, 827, 758, 697, 640, 610, 668, 725, 726, 673, 598, 529, 466, 440, 402, 328, 255, 197, 162, 109, 20, -75, -164, -212, -217, -187, -229, -236, -248, -223, -157, -92, -57, -35, -68, -47, -24, 6, 45, 17, -13, -59, -138, -225, -249, -240, -230, -195, -198, -171, -220, -264, -251, -242, -228, -236, -231, -231, -256, -234, -199, -171, -140, -41, 50, 12, -30, -33, -66, -45, 43, 157, 234, 265, 322, 377, 429, 434, 447, 501, 519, 567, 629, 675, 664, 624, 679, 738, 687, 630, 602, 668, 660, 617, 602, 659, 747, 697, 631, 658, 780, 823, 795, 838, 899, 948, 952, 974, 988, 943, 875};


// Letter L (148)
int16_t smooth2Lx[148] = {18, 40, 37, 30, 30, 20, 17, 16, 10, 11, 17, 18, 18, 12, 8, 4, 11, 18, 6, 2, 8, 12, -1, -11, 0, 19, 18, 7, -5, -16, -10, -3, 5, 1, 2, 2, -13, -17, 7, 0, -4, 2, -13, -25, -27, -18, -27, -26, -21, -31, -36, -21, -15, -29, -35, -26, -22, -30, -32, -40, -53, -66, -75, -76, -75, -82, -73, -70, -73, -76, -72, -79, -68, -75, -96, -129, -162, -176, -174, -155, -127, -97, -85, -83, -83, -84, -91, -86, -93, -108, -123, -125, -131, -144, -136, -122, -112, -108, -119, -126, -119, -120, -115, -119, -101, -71, -50, -39, -37, -41, -41, -50, -54, -35, -20, -23, -35, -32, -35, -36, -12, 24, 42, 42, 45, 27, 14, 22, 26, 15, 0, 0, 9, 6, -10, -22, -23, -19, -20, -20, -21, -30, -33, -39, -39, -31, -27, -69};
int16_t smooth2Ly[148] = {-980, -999, -988, -979, -980, -974, -966, -963, -958, -954, -955, -952, -953, -952, -949, -935, -914, -911, -915, -918, -924, -923, -921, -929, -927, -922, -922, -949, -973, -985, -990, -984, -962, -941, -944, -951, -942, -920, -905, -914, -917, -937, -964, -986, -996, -990, -986, -991, -993, -1001, -995, -980, -976, -984, -990, -982, -976, -972, -969, -975, -988, -989, -993, -994, -996, -1003, -1008, -991, -970, -959, -956, -970, -997, -1029, -1100, -1185, -1249, -1279, -1278, -1241, -1176, -1111, -1061, -1037, -1011, -994, -980, -973, -965, -967, -972, -980, -986, -983, -983, -982, -985, -984, -974, -983, -1001, -1014, -1007, -997, -981, -984, -997, -992, -986, -982, -973, -972, -976, -981, -990, -987, -988, -973, -958, -957, -966, -964, -981, -1002, -998, -1001, -1007, -1007, -997, -1002, -999, -1003, -995, -997, -1000, -993, -991, -985, -980, -970, -972, -985, -998, -1009, -1015, -1009, -996, -977};
int16_t smooth2Lz[148] = {-89, -89, -90, -84, -83, -81, -83, -91, -91, -101, -92, -81, -81, -85, -83, -78, -63, -60, -70, -76, -83, -88, -83, -74, -65, -52, -65, -77, -91, -96, -81, -70, -56, -63, -72, -66, -63, -56, -46, -53, -66, -53, -52, -64, -70, -76, -67, -43, -40, -34, -14, -6, -3, -11, -10, -12, 10, 9, -3, -6, -2, 7, 25, 42, 49, 55, 51, 56, 76, 94, 108, 97, 102, 112, 110, 114, 97, 100, 100, 112, 111, 109, 111, 114, 110, 104, 100, 91, 93, 99, 108, 114, 110, 114, 102, 105, 108, 113, 115, 114, 97, 95, 96, 109, 107, 105, 115, 126, 132, 141, 141, 140, 119, 104, 114, 127, 127, 110, 93, 84, 78, 90, 110, 135, 149, 153, 151, 142, 125, 127, 136, 131, 140, 149, 160, 158, 146, 139, 127, 126, 123, 129, 129, 148, 171, 174, 182, 187};

int16_t smooth8Lx[148] = {172, 191, 189, 251, 226, 155, 109, 58, 94, 128, 146, 142, 134, 115, 71, 70, 75, 84, 82, 120, 128, 171, 205, 200, 143, 170, 237, 216, 243, 225, 237, 170, 106, 115, 147, 105, 124, 102, 99, 134, 169, 107, 34, -1, 15, 30, 62, 86, 70, 36, -6, 5, -31, -67, 48, 156, 168, 117, 30, -47, -47, -78, -38, 59, 90, -14, -125, -224, -257, -246, -276, -267, -248, -237, -250, -298, -356, -387, -390, -366, -322, -331, -326, -316, -312, -300, -318, -329, -343, -343, -345, -288, -195, -88, 48, 184, 249, 326, 429, 473, 467, 380, 336, 259, 192, 161, 104, 59, 34, 21, 0, -19, -37, -64, -77, -88, -41, 14, 28, 7, 0, 7, 7, 47, 26, -42, -46, -35, -97, -84, -35, 0, 39, 48, 0, -39, -64, -63, -81, -99, -92, -56, -47, -43, -57, -53, -43, -40};
int16_t smooth8Ly[148] = {-3825, -3823, -3803, -3803, -3778, -3802, -3801, -3790, -3740, -3702, -3685, -3657, -3650, -3640, -3681, -3642, -3608, -3538, -3490, -3454, -3437, -3382, -3390, -3461, -3530, -3541, -3490, -3514, -3540, -3575, -3650, -3724, -3739, -3731, -3700, -3676, -3669, -3667, -3593, -3538, -3525, -3554, -3611, -3700, -3748, -3792, -3842, -3914, -3915, -3926, -3972, -3977, -3975, -3945, -3833, -3741, -3747, -3781, -3835, -3889, -3884, -3841, -3813, -3784, -3909, -4116, -4343, -4539, -4587, -4560, -4480, -4365, -4248, -4145, -4100, -4043, -4011, -3926, -3860, -3794, -3733, -3687, -3640, -3648, -3659, -3674, -3672, -3667, -3682, -3721, -3721, -3700, -3660, -3650, -3638, -3607, -3611, -3649, -3680, -3700. -3706, -3717, -3709, -3724, -3721, -3705, -3722, -3731, -3699, -3657, -3659, -3692, -3687, -3696, -3735, -3758, -3740, -3681, -3637, -3627, -3651, -3667, -3699, -3656, -3608, -3630, -3670, -3730, -3778, -3776, -3721, -3710, -3623, -3689, -3710, -3724, -3703, -3678, -3701, -3700, -3669, -3662, -3651, -3648, -3660, -3671, -3667, -3678};
int16_t smooth8Lz[148] = {-139, -108, -120, -129, -136, -129, -134, -104, -65, -82, -76, -60, -101, -150, -190, -214, -194, -135, -119, -146, -95, -41, -71, -110, -101, 22, 98, 120, 68, 32, -11, 55, 116, 169, 187, 165, 76, 49, 134, 188, 165, 186, 163, 150, 140, 246, 261, 297, 331, 403, 433, 440, 476, 538, 612, 730, 781, 772, 767, 772, 809, 903, 999, 1063, 1122, 1170, 1162, 1130, 1096, 1088, 1116, 1154, 1214, 1233, 1255, 1248, 1261, 1244, 1222, 1188, 1161, 1186, 1184, 1165, 1141, 1165, 1202, 1165, 1145, 1136, 1151, 1179, 1207, 1175, 1161, 1140, 1189, 1207, 1248, 1311, 1367, 1363, 1328, 1319, 1274, 1215, 1189, 1161, 1184, 1208, 1225, 1252, 1258, 1249, 1248, 1264, 1250, 1287, 1289, 1267, 1249, 1301, 1341, 1343, 1321, 1306, 1287, 1190, 1249, 1322, 1379, 1412, 1308, 1278, 1288, 1309, 1309, 1257, 1269, 1295, 1318, 1314, 1269, 1261, 1231, 1255, 1263, 1287};

void printArray(double *array, int size) {
    int i;
    for (i = 0; i < size; i++) {
        printf("%lf, ", array[i]);
    }
}

void printMatrix(double *matrix, int rows, int columns) {
    int i, j;
    for (i = 0; i < rows; i++) {
        for (j = 0; j < columns; j++) {
            printf("%.2lf ", *(matrix + (i * columns) + j));
        }
        printf("\n");
    }
}

int16_t average(int16_t *array, int begin, int end) {
    int16_t sum = 0;
    int i;
    for(i = begin; i < end; i++) {
        sum += array[i];
    }
    return sum / (int16_t) end - begin;
}

int16_t min(int16_t a, int16_t b, int16_t c) {
    if(a < b) {
        return a < c ? a : c;
    }
    return b < c ? b : c;
}

void ewma(int16_t *array, int size, int16_t *result) {

    int s = size < 6 ? size : 6;
    int16_t forecasted = average(array, 0, s);
    int16_t smoothed = 0;

    int i;

    for (i = 1; i <= size; i++) {
        smoothed = EWMA_ALPHA * array[i - 1] + (1.0 - EWMA_ALPHA) * forecasted;
        forecasted = smoothed;
        result[i - 1] = smoothed;
    }

}

double dtwDistance(int16_t *ax, int16_t *ay, int16_t *az, int sa, int16_t *bx, int16_t *by, int16_t *bz, int sb) {

	int16_t acc[sb][sa];
	int16_t dist;

    acc[0][0] = pow(ax[0] - bx[0], 2.0) + pow(ay[0] - by[0], 2.0) + pow(az[0] - bz[0], 2.0);

    // Accumulated distance - Row 0
    for (int i = 1; i < sa; i++) {
        dist = pow(ax[i] - bx[0], 2.0) + pow(ay[i] - by[0], 2.0) + pow(az[i] - bz[0], 2.0);
        acc[0][i] = acc[0][i - 1] + dist;
    }

    // Accumulated distance - Row 0
    for (int i = 1; i < sb; i++) {
        dist = pow(ax[0] - bx[i], 2.0) + pow(ay[0] - by[i], 2.0) + pow(az[0] - bz[i], 2.0);
        acc[i][0] = acc[i - 1][0] + dist;
    }

    // Accumlated distance - Remaining
    double m;
    for (int i = 1; i < sb; i++) {
        for (int j = 1; j < sa; j++) {
            dist = pow(ax[j] - bx[i], 2.0) + pow(ay[j] - by[i], 2.0) + pow(az[j] - bz[i], 2.0);
            m = min(acc[i - 1][j - 1],
                    acc[i - 1][j],
                    acc[i][j - 1]);
            acc[i][j] = m + dist;
        }
    }

    return sqrt((double) acc[sb - 1][sa - 1]);

}

int knn(int16_t *inputX, int16_t *inputY, int16_t *inputZ, int size) {
	double distanceO = dtwDistance(smooth8Ox, smooth8Oy, smooth8Oz, 148, inputX, inputY, inputZ, size);
	double distanceL = dtwDistance(smooth8Lx, smooth8Ly, smooth8Lz, 148, inputX, inputY, inputZ, size);
    return distanceO < distanceL ? 0 : 1;
}
